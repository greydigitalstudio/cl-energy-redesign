if (jQuery(".burger-button").click((function () {
    jQuery(this).toggleClass("show"), jQuery(".header-menu").toggleClass("show"), jQuery("body").toggleClass("body-hidden")
})), jQuery(window).width() < 576) {
    let e = '<button class="main-banner-info-icon"><i class="fa-solid fa-circle-info"></i></button>';
    jQuery(".main-banner-slider__item").append(e), jQuery(".main-banner-info-icon").click((function () {
        jQuery(this).closest(".main-banner-slider__item").children(".main-banner-slider-list").toggleClass("show")
    }))
}
if ($(document).click((function (e) {
    $(e.target).closest(".main-banner-info-icon").length || jQuery(".main-banner-slider-list").removeClass("show")
})), jQuery(window).width() < 992) {
    let e = '<button class="car-page-banner-info-btn"><i class="fa-solid fa-circle-info"></i></button>';
    jQuery(".car-page-banner-overlay__btns").append(e), jQuery(".car-page-banner-info-btn").click((function () {
        jQuery(".car-page-banner-list").toggleClass("show")
    }))
}
$(document).click((function (e) {
    $(e.target).closest(".car-page-banner-info-btn").length || jQuery(".car-page-banner-list").removeClass("show")
})), function (e) {
    let n = document.querySelectorAll(".accordion-title"),
        t = document.querySelectorAll(".content"),
        i = document.querySelectorAll(".accordion-icon");

    function o(e) {
        let o = e.currentTarget.nextElementSibling.classList,
            a = e.currentTarget.children[0],
            r = e.currentTarget;
        o.contains("show") ? (o.remove("show"), a.classList.remove("rotate"), r.classList.remove("active")) : (n.forEach((function (e) {
            e.classList.remove("active"), t.forEach((function (e) {
                e.classList.remove("show")
            })), i.forEach((function (e) {
                e.classList.remove("rotate")
            }))
        })), o.add("show"), r.classList.add("active"), a.classList.add("rotate"))
    }
    n.forEach((function (e) {
        e.addEventListener("click", o)
    }))
}(jQuery);

document.addEventListener("DOMContentLoaded", function () {

    gsap.registerPlugin(ScrollTrigger);


    // gsap.to('.services-box', {
    //     scrollTrigger: {
    //         trigger: '.services-box',
    //         start: () => "top top",
    //         end: () => "bottom top",
    //         scrub: 1,
    //         pin: true,
    //         markers: true
    //     },
    //     y: 0
    // })
    document.querySelectorAll('.services-box').forEach(item => {
        console.log(item);
        gsap.to(item.querySelector('.img-wrap'), {
            scrollTrigger: {
                trigger: item,
                start: () => "top+=100 bottom",
                end: () => `bottom+=${window.innerHeight / 4} bottom`,
                scrub: 1.5,
            },
            y: () => 0,
            x: () => 0,
        })
        gsap.to(item.querySelector('.text-wrap'), {
            scrollTrigger: {
                trigger: item,
                start: () => "top+=100 bottom",
                end: () => `bottom+=${window.innerHeight / 4} bottom`,
                scrub: 1.5,
            },
            y: () => 0,
            x: () => 0,
        })
    })

    new WOW().init();


    if (document.querySelector('.main-banner-slider')) {
        new Glide('.main-banner-slider', {
            type: 'carousel',
            focusAt: 'center',
            animationDuration: 800,
            autoplay: 3000,
            perView: 1,
            gap: 0,
        }).mount();
    }
    if (document.querySelector('.services-slider-1')) {
        new Glide('.services-slider-1', {
            type: 'carousel',
            focusAt: 'center',
            animationDuration: 800,
            autoplay: 3000,
            perView: 1,
            gap: 0,
        }).mount();
    }
    if (document.querySelector('.services-slider-2')) {
        new Glide('.services-slider-2', {
            type: 'carousel',
            focusAt: 'center',
            animationDuration: 800,
            autoplay: 3000,
            perView: 1,
            gap: 0,
        }).mount();
    }
    if (document.querySelector('.services-slider-3')) {
        new Glide('.services-slider-3', {
            type: 'carousel',
            focusAt: 'center',
            animationDuration: 800,
            autoplay: 3000,
            perView: 1,
            gap: 0,
        }).mount();
    }
    if (document.querySelector('.car-banner-slider')) {
        new Glide('.car-banner-slider', {
            type: 'carousel',
            focusAt: 'center',
            animationDuration: 800,
            autoplay: 3000,
            perView: 1,
            gap: 0
        }).mount();
    }
    if (document.querySelector('.gallery-slider')) {
        new Glide('.gallery-slider', {
            type: 'carousel',
            focusAt: 'center',
            animationDuration: 800,
            perView: 5,
            breakpoints: {
                1440: {
                    perView: 4
                },
                1280: {
                    perView: 3
                },
                768: {
                    perView: 2
                },
                575: {
                    perView: 1
                }
            }
        }).mount();
    }
});



if (document.querySelector('#configurator')) {

    // Объект добавляется в экземпляр Vue
    var vm = new Vue({
        el: '#configurator',
        data: {
            selectedModelKey: "s",
            slider: null,
            prepay: 432500, // RUB
            isTotalPrepayed: false,
            steps: [{
                id: 0,
                isCompleated: false,
                isActive: true,
                name: "Модель и комплектация"
            },
            {
                id: 1,
                isCompleated: false,
                isActive: false,
                name: "Цвет и диски"
            },
            {
                id: 2,
                isCompleated: false,
                isActive: false,
                name: "Интерьер"
            },
            {
                id: 3,
                isCompleated: false,
                isActive: false,
                name: "Автопилот"
            },
            {
                id: 4,
                isCompleated: false,
                isActive: false,
                name: "Оформление заказа"
            }
            ],
            models: [{
                name: "Tesla Model S",
                key: 's',
                colors: {
                    selected: 0,
                    items: [{
                        code: "#DADADA",
                        prefix: 'white',
                        name: "Белый перламутровый",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#000",
                        prefix: 'black',
                        name: "Черный перламутровый",
                        price: 138400, // RUB
                        id: 1
                    },
                    {
                        code: "#00f",
                        prefix: 'blue',
                        name: "Синий перламутровый",
                        price: 138400, // RUB
                        id: 2
                    },
                    {
                        code: "gray",
                        prefix: 'gray',
                        name: "Серый перламутровый",
                        price: 138400, // RUB
                        id: 3
                    },
                    {
                        code: "#f00",
                        prefix: 'red',
                        name: "Красный перламутровый",
                        price: 250850, // RUB
                        id: 4
                    }
                    ]
                },
                rims: {
                    selected: 0,
                    items: [{
                        id: 0,
                        radius: 19,
                        price: 0,
                        name: "Tempest Wheels",
                        image: '/images/rims/s-rim0.png'
                    },
                    {
                        id: 1,
                        radius: 20,
                        price: 406550, // RUB
                        name: "Cyberstream Wheels",
                        image: '/images/rims/s-rim1.png'
                    }
                    ]
                },
                salons: {
                    selected: 0,
                    items: [{
                        code: "#000",
                        prefix: 'black',
                        name: "Полностью черный интерьер «Ebony Décor»",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#f3eadb",
                        prefix: 'beige',
                        name: "Бежевый интерьер «Ebony Décor»",
                        price: 181650, // RUB
                        id: 1
                    },
                    {
                        code: "#fff",
                        prefix: 'white',
                        name: "Полностью белый интерьер «Ebony Décor»",
                        price: 181650, // RUB
                        id: 2
                    }
                    ]
                },
                autopilot: {
                    selected: 0,
                    items: [{
                        name: "Базовый автопилот",
                        price: 0,
                        id: 0
                    },
                    {
                        name: "Улучшенный автопилот",
                        price: 328700, // RUB
                        id: 1
                    },
                    {
                        name: "Полный автопилот",
                        price: 648750, // RUB
                        id: 2
                    }
                    ]
                },
                complects: {
                    selected: 'longrange',
                    items: [{
                        name: 'Long range',
                        key: 'longrange',
                        price: 12401591, // RUB,
                        prepay_price: 10587946,
                        params: [{
                            range: 652,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 250,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 3.2,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    },
                    {
                        name: 'Plaid',
                        key: 'plaid',
                        price: 14601978,
                        prepay_price: 12923446,
                        params: [{
                            range: 628,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 322,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 2.1,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    }
                    ]
                }

            },
            {
                name: "Tesla Model 3",
                key: '3',
                colors: {
                    selected: 0,
                    items: [{
                        code: "#DADADA",
                        prefix: 'white',
                        name: "Белый перламутровый",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#000",
                        prefix: 'black',
                        name: "Черный перламутровый",
                        price: 138400, // RUB
                        id: 1
                    },
                    {
                        code: "#00f",
                        prefix: 'blue',
                        name: "Синий перламутровый",
                        price: 138400, // RUB
                        id: 2
                    },
                    {
                        code: "gray",
                        prefix: 'gray',
                        name: "Серый перламутровый",
                        price: 138400, // RUB
                        id: 3
                    },
                    {
                        code: "#f00",
                        prefix: 'red',
                        name: "Красный перламутровый",
                        price: 250850, // RUB
                        id: 4
                    }
                    ]
                },
                rims: {
                    selected: 0,
                    items: [{
                        id: 0,
                        radius: 18,
                        price: 0,
                        name: "Aero Wheels",
                        image: '/images/rims/3-rim0.png'
                    },
                    {
                        id: 1,
                        radius: 19,
                        price: 147050, // RUB
                        name: "Aero Wheels",
                        image: '/images/rims/3-rim1.png'
                    }
                    ]
                },
                salons: {
                    selected: 0,
                    items: [{
                        code: "#000",
                        prefix: 'black',
                        name: "Полностью черный интерьер «Ebony Décor»",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#fff",
                        prefix: 'white',
                        name: "Полностью белый интерьер «Ebony Décor»",
                        price: 10328700, // RUB // RUB
                        id: 1
                    }
                    ]
                },
                autopilot: {
                    selected: 0,
                    items: [{
                        name: "Базовый автопилот",
                        price: 0,
                        id: 0
                    },
                    {
                        name: "Улучшенный автопилот",
                        price: 328700, // RUB
                        id: 1
                    },
                    {
                        name: "Полный автопилот",
                        price: 648750, // RUB
                        id: 2
                    }
                    ]
                },
                complects: {
                    selected: 'standartplus',
                    items: [{
                        name: 'Standart',
                        key: 'standartplus',
                        price: 4975739, // RUB
                        prepay_price: 4759489,
                        params: [{
                            range: 423,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 225,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 5.3,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    },
                    {
                        name: 'Long range',
                        key: 'longrange',
                        price: 5700523, // RUB
                        prepay_price: 5484273,
                        params: [{
                            range: 568,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 233,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 4.2,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    },
                    {
                        name: 'Perfomance',
                        key: 'perfomance',
                        price: 6022649, // RUB
                        prepay_price: 5806399,
                        params: [{
                            range: 507,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 261,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 3.1,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    }
                    ]
                }

            },
            {
                name: "Tesla Model X",
                key: 'x',
                colors: {
                    selected: 0,
                    items: [{
                        code: "#DADADA",
                        prefix: 'white',
                        name: "Белый перламутровый",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#000",
                        prefix: 'black',
                        name: "Черный перламутровый",
                        price: 138400, // RUB
                        id: 1
                    },
                    {
                        code: "#00f",
                        prefix: 'blue',
                        name: "Синий перламутровый",
                        price: 138400, // RUB
                        id: 2
                    },
                    {
                        code: "gray",
                        prefix: 'gray',
                        name: "Серый перламутровый",
                        price: 138400, // RUB
                        id: 3
                    },
                    {
                        code: "#f00",
                        prefix: 'red',
                        name: "Красный перламутровый",
                        price: 250850, // RUB
                        id: 4
                    }
                    ]
                },
                rims: {
                    selected: 0,
                    items: [{
                        id: 0,
                        radius: 20,
                        price: 0,
                        name: "Cyberstream Wheels",
                        image: '/images/rims/x-rim0.png'
                    },
                    {
                        id: 1,
                        radius: 22,
                        price: 501700, // RUB
                        name: "Cyberstream Wheels",
                        image: '/images/rims/x-rim1.png'
                    }
                    ]
                },
                salons: {
                    selected: 0,
                    items: [{
                        code: "#000",
                        prefix: 'black',
                        name: "Полностью черный интерьер «Ebony Décor»",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#f3eadb",
                        prefix: 'beige',
                        name: "Бежевый интерьер «Ebony Décor»",
                        price: 181650, // RUB
                        id: 1
                    },
                    {
                        code: "#fff",
                        prefix: 'white',
                        name: "Полностью белый интерьер «Ebony Décor»",
                        price: 181650, // RUB
                        id: 2
                    }
                    ]
                },
                autopilot: {
                    selected: 0,
                    items: [{
                        name: "Базовый автопилот",
                        price: 0,
                        id: 0
                    },
                    {
                        name: "Улучшенный автопилот",
                        price: 328700, // RUB
                        id: 1
                    },
                    {
                        name: "Полный автопилот",
                        price: 648750, // RUB
                        id: 2
                    }
                    ]
                },
                seets: {
                    selected: 0,
                    items: [{
                        name: "Пять мест",
                        price: 0,
                        id: 0
                    },
                    {
                        name: "Шесть мест",
                        price: 588200, // RUB
                        id: 1
                    },
                    {
                        name: "Семь мест",
                        price: 320050, // RUB
                        id: 2
                    }
                    ]
                },
                complects: {
                    selected: 'longrange',
                    items: [{
                        name: 'Long range',
                        key: 'longrange',
                        price: 12902167, // RUB
                        prepay_price: 12685917,
                        params: [{
                            range: 663,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 250,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 3.1,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    },
                    {
                        name: 'Plaid',
                        key: 'plaid',
                        price: 13578510, // RUB
                        prepay_price: 13362260,
                        params: [{
                            range: 627,
                            measuring: 'км',
                            title: 'Запас хода'
                        },
                        {
                            range: 262,
                            measuring: 'км/ч',
                            title: 'Макс скорость'
                        },
                        {
                            range: 1.99,
                            measuring: 'сек',
                            title: 'Разгон от 0 - 100'
                        }
                        ]
                    }
                    ]
                }

            },
            {
                name: "Tesla Model Y",
                key: 'y',
                colors: {
                    selected: 0,
                    items: [{
                        code: "#DADADA",
                        prefix: 'white',
                        name: "Белый перламутровый",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#000",
                        prefix: 'black',
                        name: "Черный перламутровый",
                        price: 138400, // RUB
                        id: 1
                    },
                    {
                        code: "#00f",
                        prefix: 'blue',
                        name: "Синий перламутровый",
                        price: 138400, // RUB
                        id: 2
                    },
                    {
                        code: "gray",
                        prefix: 'gray',
                        name: "Серый перламутровый",
                        price: 138400, // RUB
                        id: 3
                    },
                    {
                        code: "#f00",
                        prefix: 'red',
                        name: "Красный перламутровый",
                        price: 250850,  // RUB
                        id: 4
                    }
                    ]
                },
                rims: {
                    selected: 0,
                    items: [{
                        id: 0,
                        radius: 19,
                        price: 0,
                        name: "Sport",
                        image: '/images/rims/y-rim0.png'
                    },
                    {
                        id: 1,
                        radius: 20,
                        price: 190300, // RUB
                        name: "Sport",
                        image: '/images/rims/y-rim1.png'
                    }
                    ]
                },
                salons: {
                    selected: 0,
                    items: [{
                        code: "#000",
                        prefix: 'black',
                        name: "Полностью черный интерьер премиум-класса",
                        price: 0,
                        id: 0
                    },
                    {
                        code: "#fff",
                        prefix: 'white',
                        name: "Полностью белый интерьер премиум-класса",
                        price: 103800, // RUB
                        id: 1
                    }
                    ]
                },
                autopilot: {
                    selected: 0,
                    items: [{
                        name: "Базовый автопилот",
                        price: 0,
                        id: 0
                    },
                    {
                        name: "Улучшенный автопилот",
                        price: 328700, // RUB
                        id: 1
                    },
                    {
                        name: "Полный автопилот",
                        price: 648750, // RUB
                        id: 2
                    }
                    ]
                },
                seets: {
                    selected: 0,
                    items: [{
                        name: "Пять мест",
                        price: 0,
                        id: 0
                    }]
                },
                complects: {
                    selected: 'longrange',
                    items: [
                        {
                            name: 'Long range',
                            key: 'longrange',
                            price: 6072213, // RUB
                            prepay_price: 5855963,
                            params: [{
                                range: 507,
                                measuring: 'км',
                                title: 'Запас хода'
                            },
                            {
                                range: 217,
                                measuring: 'км/ч',
                                title: 'Макс скорость'
                            },
                            {
                                range: 4.8,
                                measuring: 'сек',
                                title: 'Разгон от 0 - 100'
                            }
                            ]
                        },
                        {
                            name: 'Perfomance',
                            key: 'perfomance',
                            price: 6901143, // RUB
                            prepay_price: 6684893,
                            params: [{
                                range: 480,
                                measuring: 'км',
                                title: 'Запас хода'
                            },
                            {
                                range: 249,
                                measuring: 'км/ч',
                                title: 'Макс скорость'
                            },
                            {
                                range: 3.5,
                                measuring: 'сек',
                                title: 'Разгон от 0 - 100'
                            }
                            ]
                        }
                    ]
                }

            },
            ]
        },
        mounted() {
            if (document.querySelector('.configurator__screen-left.glide')) {
                this.slider = new Glide('.configurator__screen-left.glide').mount()
            }
        },
        computed: {
            computed90PerPrice() {
                return this.computedComplect.price / 100 * 90;
            },
            totalInfo() {
                string = "";
                if (this.computedComplect.price) {
                    string += "\n Комплект: " + this.computedComplect.name + ", ";
                }
                if (this.computedModel.colors.items.length) {
                    string += "\n Цвет: " + this.computedModel.colors.items[this.computedModel.colors.selected].name + ", ";
                }
                if (this.computedModel.rims.items.length) {
                    string += "\n Диски: " + this.computedModel.rims.items[this.computedModel.rims.selected].name + ", ";
                }
                if (this.computedModel.salons.items.length) {
                    string += "\n Салон: " + this.computedModel.salons.items[this.computedModel.salons.selected].name + ", ";
                }
                if (this.computedModel.seets && this.computedModel.seets.items.length) {
                    string += "\n Сидений: " + this.computedModel.seets.items[this.computedModel.seets.selected].name + ", ";
                }
                if (this.computedModel.autopilot.items.length) {
                    string += "\n Автопилот: " + this.computedModel.autopilot.items[this.computedModel.autopilot.selected].name + ", ";
                }
                if (this.isTotalPrepayed) {
                    string += "\n Предоплата: 90%, ";
                }
                if (!this.isTotalPrepayed) {
                    string += `\n Предоплата: 5 000 € (${this.prepay.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB', })}), `;
                }
                return string;
            },
            totalPrice() {
                let price = 0;
                if (this.computedComplect.price && !this.isTotalPrepayed) {
                    price += this.computedComplect.price;
                }
                if (this.computedComplect.price && this.isTotalPrepayed) {
                    price += this.computedComplect.prepay_price;
                }
                if (this.computedModel.colors.items.length) {
                    price += this.computedModel.colors.items[this.computedModel.colors.selected].price;
                }
                if (this.computedModel.rims.items.length) {
                    price += this.computedModel.rims.items[this.computedModel.rims.selected].price;
                }
                if (this.computedModel.salons.items.length) {
                    price += this.computedModel.salons.items[this.computedModel.salons.selected].price;
                }
                if (this.computedModel.seets && this.computedModel.seets.items.length) {
                    price += this.computedModel.seets.items[this.computedModel.seets.selected].price;
                }
                if (this.computedModel.autopilot.items.length) {
                    price += this.computedModel.autopilot.items[this.computedModel.autopilot.selected]
                        .price;
                }
                return price;
            },
            computedModel() {
                const model = this.models.filter(model => model.key == this.selectedModelKey);
                return model.length ? model[0] : [];
            },
            computedComplect() {
                const complect = this.computedModel.complects.items.filter(complect => complect.key == this
                    .computedModel.complects.selected);
                return complect.length ? complect[0] : [];
            },
            curentStepIndex() {
                const curentStep = this.steps.filter(step => step.isActive);
                console.log(curentStep);
                return curentStep.length ? curentStep[0].id : 0;
            }
        },
        methods: {
            nextStep() {
                setTimeout(() => {
                    window.dispatchEvent(new Event('resize'));
                }, 0);
                const index = this.curentStepIndex;

                if (index + 1 > this.steps.length - 1) return;

                this.steps[index + 1].isActive = true;
                this.steps[index].isCompleated = true;
                this.steps[index].isActive = false;
            },
            prevStep() {
                setTimeout(() => {
                    window.dispatchEvent(new Event('resize'));
                }, 0);
                const index = this.curentStepIndex;

                if (index < 1) return;

                this.steps[index - 1].isActive = true;
                this.steps[index - 1].isCompleated = false;
                this.steps[index].isActive = false;
            },
            sendForm() {
                $('#send_tesla_form').click();
            },
        }
    })
}